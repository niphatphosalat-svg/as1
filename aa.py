# aa.py
from ultralytics import YOLO
import cv2
import matplotlib.pyplot as plt

# ‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏°‡πÄ‡∏î‡∏• YOLOv8 ‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ó‡∏£‡∏ô‡∏°‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß
# yolov8n.pt = ‡∏£‡∏∏‡πà‡∏ô‡πÄ‡∏•‡πá‡∏Å (‡πÄ‡∏£‡πá‡∏ß)
# yolov8s.pt = ‡∏£‡∏∏‡πà‡∏ô‡∏Å‡∏•‡∏≤‡∏á (‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡∏Å‡∏ß‡πà‡∏≤ ‡πÅ‡∏ï‡πà‡∏ä‡πâ‡∏≤‡∏Å‡∏ß‡πà‡∏≤)
model = YOLO('yolov8n.pt')

# ======== ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏û‡∏≤‡∏ò‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û ========
image_path = 'aa.png'   # üëâ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡∏†‡∏≤‡∏û‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ‡πÄ‡∏ä‡πà‡∏ô 'test.jpg'

# ‡∏≠‡πà‡∏≤‡∏ô‡∏†‡∏≤‡∏û
image = cv2.imread(image_path)

# ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡πÉ‡∏ô‡∏†‡∏≤‡∏û
results = model(image)

# ‡∏î‡∏∂‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏à‡∏≤‡∏Å‡πÇ‡∏°‡πÄ‡∏î‡∏•
boxes = results[0].boxes
names = model.names

# ======== ‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå ========
car_count = 0
for box in boxes:
    cls = int(box.cls[0])  # ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏•‡∏≤‡∏™
    label = names[cls]     # ‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏
    if label == 'car':     # ‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞ "car"
        car_count += 1

# ======== ‡∏ß‡∏≤‡∏î‡∏Å‡∏£‡∏≠‡∏ö Bounding Box ========
annotated_image = results[0].plot()

# ‡πÅ‡∏™‡∏î‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå‡πÉ‡∏ô Terminal
print(f"‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: {car_count}")

# ======== ‡πÅ‡∏™‡∏î‡∏á‡∏†‡∏≤‡∏û‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå ========
plt.figure(figsize=(10, 6))
plt.imshow(cv2.cvtColor(annotated_image, cv2.COLOR_BGR2RGB))
plt.axis('off')
plt.title(f'‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: {car_count}')
plt.show()
